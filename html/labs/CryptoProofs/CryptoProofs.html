<?xml version='1.0' encoding='UTF-8'?> <link href="/github-markdown-css/github-css.css" rel="stylesheet"/> <meta charset="utf-8" content="text/html"/> <div class="gist"> <style class="formula-style"> svg.gh-md-to-html-formula { fill: black; } </style> <div class="gist-file"> <!-- This is the class that is responsible for the boxing! --> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container file-box"> <div class="file" id="article-CryptoProofs"> <div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px"> <article class="markdown-body entry-content container-lg" itemprop="text"> <h1> <a aria-hidden="true" class="anchor" href="#introduction" id="user-content-introduction"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h1> <p>Cryptol and SAW allow users to rapidly and transparently deploy powerful theorem proving tools to explore their code.</p> <h2> <a aria-hidden="true" class="anchor" href="#prerequisites" id="user-content-prerequisites"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h2> <p>Before working through this lab, you'll need</p> <ul> <li>Cryptol to be installed,</li> <li>this module to load successfully, and</li> <li>an editor for completing the exercises in this file.</li> </ul> <p>You'll also need experience with</p> <ul> <li>loading modules and evaluating functions in the interpreter,</li> <li>sequence and <code>Integer</code> types,</li> <li>the <code>:prove</code> and <code>:sat</code> commands,</li> <li>manipulating sequences using <code>#</code>, <code>take</code>, <code>split</code>, and <code>join</code>,</li> <li>writing functions and properties,</li> <li>lambda functions,</li> <li>sequence comprehensions, and</li> <li>logical, comparison, and arithmetic operators.</li> </ul> <h2> <a aria-hidden="true" class="anchor" href="#skills-youll-learn" id="user-content-skills-youll-learn"><span aria-hidden="true" class="octicon octicon-link"></span></a>Skills You'll Learn</h2> <p>By the end of this lab you will be able to describe and demonstrate five powerful classes of proofs that can be applied to a wide variety of cryptographic algorithms.</p> <p>You'll also gain experience with</p> <ul> <li>lambda functions,</li> <li> <code>:prove</code> and <code>:sat</code> commands, and</li> <li>different provers.</li> </ul> <h2> <a aria-hidden="true" class="anchor" href="#load-this-module" id="user-content-load-this-module"><span aria-hidden="true" class="octicon octicon-link"></span></a>Load This Module</h2> <p>This lab is a <a href="https://en.wikipedia.org/wiki/Literate_programming" rel="nofollow">literate</a> Cryptol document --- that is, it can be loaded directly into the Cryptol interpreter. Load this module from within the Cryptol interpreter running in the <code>cryptol-course</code> directory with:</p> <pre lang="Xcryptol"><code>Loading module Cryptol Cryptol&gt; :m labs::CryptoProofs::CryptoProofs Loading module Cryptol Loading module specs::Primitive::Symmetric::Cipher::Block::Cipher Loading module specs::Primitive::Symmetric::Cipher::Block::DES Loading module labs::CryptoProofs::CryptoProofs </code></pre> <p>The proofs in this lab require an array of different theorem provers supported by Cryptol. In order to solve them, we recommend using the Cryptol Docker container described in the README.md for this course.</p> <p>First, since we are creating a module, the first line needs to be the module definition.</p> <pre lang="cryptol"><code>module labs::CryptoProofs::CryptoProofs where </code></pre> <p>You do not need to enter the above into the interpreter; the previous <code>:m ...</code> command loaded this literate Cryptol file automatically. In general, you should run <code>Xcryptol session</code> commands in the interpreter and leave <code>cryptol</code> code alone to be parsed by <code>:m ...</code>.</p> <h1> <a aria-hidden="true" class="anchor" href="#exploring-cryptography-with-cryptols-proof-tools" id="user-content-exploring-cryptography-with-cryptols-proof-tools"><span aria-hidden="true" class="octicon octicon-link"></span></a>Exploring Cryptography with Cryptol's Proof Tools</h1> <h2> <a aria-hidden="true" class="anchor" href="#1-des" id="user-content-1-des"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. DES</h2> <p>To start, we'll analyze the DES (Data Encryption Standard) algorithm. Let's take a moment to familiarize ourselves with how it works.</p> <p>First, we import it.</p> <pre lang="cryptol"><code>import specs::Primitive::Symmetric::Cipher::Block::DES </code></pre> <p>When you loaded the <code>labs::CryptoProofs::CryptoProofs</code> module, these lines should have been printed:</p> <pre lang="Xcryptol"><code>Loading module Cryptol Loading module specs::Primitive::Symmetric::Cipher::Block::Cipher Loading module specs::Primitive::Symmetric::Cipher::Block::DES Loading module labs::CryptoProofs::CryptoProofs </code></pre> <p>In reverse order: the third line says that this module has been loaded. Since it imported the DES module, Cryptol helpfully tells you that DES has been loaded. Since DES imported the Cipher module, Cryptol tells you that too.</p> <p>Next, we'll take a look at the type of the DES encryption function.</p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; :t DES.encrypt DES.encrypt : [64] -&gt; [64] -&gt; [64] </code></pre> <p>DES takes two 64-bit values and returns a 64-bit value. (The key comes first and then the plaintext.) Let's encrypt something with DES.</p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; DES.encrypt 0x752979387592cb70 0x1122334455667788 0xb5219ee81aa7499d </code></pre> <p>Now decrypt:</p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; DES.decrypt 0x752979387592cb70 0xb5219ee81aa7499d 0x1122334455667788 </code></pre> <p>Now that we have DES working, let's analyze it!</p> <h2> <a aria-hidden="true" class="anchor" href="#2-five-killer-apps" id="user-content-2-five-killer-apps"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Five Killer Apps</h2> <p>For the rest of the lab, we'll be looking at some of the types of questions you can ask (and often answer!) using Cryptol's powerful automated theorem proving capabilities. These are important questions that one might ask about a cryptographic algorithm along with a generic "one-liner" Cryptol invocation. (Don't worry if you don't understand these yet.)</p> <table> <thead> <tr> <th>Proof</th> <th>Invocation</th> </tr> </thead> <tbody> <tr> <td>Function reversal</td> <td><code>:sat \x -&gt; f x == y</code></td> </tr> <tr> <td>Proof of inversion</td> <td><code>:prove \x -&gt; g (f x) == x</code></td> </tr> <tr> <td>Proof of injectivity</td> <td><code>:prove \x y -&gt; x != y ==&gt; f x != f y</code></td> </tr> <tr> <td>Collision detection</td> <td><code>:sat \x y -&gt; f x == f y /\ x != y</code></td> </tr> <tr> <td>Equivalence checking</td> <td><code>:prove \x -&gt; f x == g x</code></td> </tr> </tbody> </table> <p>Each subsection below will explore one of these questions in-depth.</p> <h3> <a aria-hidden="true" class="anchor" href="#21-function-reversal" id="user-content-21-function-reversal"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.1 Function Reversal</h3> <p>It may be interesting to explore whether a particular cryptographic function can be reversed. Some examples of usage:</p> <ul> <li>Attempt to reverse a hash function. This is called a preimage attack. (Of course, strong cryptographic hash functions are designed to resist this type of analysis.)</li> <li>Carry out decryption when all you have is the encryption function.</li> <li>In general, find an input given an output!</li> </ul> <p>We'll start with an example where we reverse the following simple function:</p> <pre lang="cryptol"><code>/** square - multiplies an Integer by itself github-markdown-css/ html/ labs/ misc/ scripts/ specs/ square : Integer -&gt; Integer square x = x INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs x </code></pre> <p>Now we can reverse it from the REPL. Let's use the solver to find a square root using only a squaring function!</p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; :sat \x -&gt; square x == 1764 Satisfiable (\x -&gt; square x == 1764) 42 = True (Total Elapsed Time: 0.021s, using "Z3") </code></pre> <p>Let's take a closer look at this query, which makes use of a <em>lambda</em> (anonymous/unnamed/on-the-fly) function. Here's the breakdown:</p> <table> <thead> <tr> <th>Function Reversal</th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <td><code>:sat</code></td> <td><code>\x</code></td> <td><code>-&gt;</code></td> <td><code>square x == 1764</code></td> </tr> <tr> <td>"Hey SAT solver!"</td> <td>"Does there exist an <code>x</code>"</td> <td>"such that"</td> <td>"<code>x</code> squared equals <code>1764</code>?"</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> </tbody> </table> <p>For more information on lambda functions in Cryptol, see Section 1.13.3 of <a href="https://github.com/GaloisInc/cryptol/blob/master/docs/ProgrammingCryptol.pdf">Programming Cryptol</a>.</p> <p><strong>EXERCISE</strong>: 2.1.1 Reverse DES.encrypt</p> <p>Given the following key and ciphertext, find the plaintext using only the solver and the <code>DES.encrypt</code> function. To do this, head over to the Cryptol interpreter, load up the module, and use the <code>:sat</code> command similar to the example above.</p> <pre lang="cryptol"><code>known_key = 0x752979387592cb70 known_ct = 0xf2930290ea4db580 </code></pre> <p>Note: For whatever reason, the default Z3 solver has trouble with this one. Try one of the other solvers, such as YICES:</p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; :s prover=yices </code></pre> <p>Or use all the installed solvers in a first-to-the-post race. <em>Caution! May exhaust system resources.</em></p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; :s prover=any </code></pre> <p><strong>EXERCISE</strong>: 2.1.2 Breaking DES</p> <p>Given the following matched plaintext and ciphertext, ask the solver to find the key. Will this work? Why or why not? (<em>Hint</em>: see plaintext.) Note that you can stop the solver at any time by hitting <code>ctrl-c</code>.</p> <pre lang="cryptol"><code>matched_pt = join "tootough" matched_ct = 0x95d07f8a72707733 </code></pre> <p>To make this solvable, try it again with the first six bytes of key provided: <code>0x1234567890ab</code>.</p> <h3> <a aria-hidden="true" class="anchor" href="#22-proof-of-inversion" id="user-content-22-proof-of-inversion"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.2 Proof of Inversion</h3> <p>For symmetric ciphers, it is necessary that the decrypt function <em>inverts</em> the encrypt function. (That is, it restores the ciphertext to the original plaintext.) It is easy to express this property in Cryptol.</p> <p>Consider the following functions <code>f</code> and <code>g</code>:</p> <pre lang="cryptol"><code>f: Integer -&gt; Integer f x = 3 INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs x + 2 g: Integer -&gt; Integer g x = (x - 2) / 3 </code></pre> <p>We want to prove that function <code>g</code> inverts function <code>f</code>; that is, applying <code>g</code> to the result of <code>f x</code> gets <code>x</code> back. Here's the invocation:</p> <pre lang="Xcryptol"><code>labs::CryptoProofs::CryptoProofs&gt; :prove \x -&gt; g (f x) == x Q.E.D. (Total Elapsed Time: 0.023s, using "Z3") </code></pre> <p>Here's the breakdown of this proof:</p> <table> <thead> <tr> <th>Proof of Inversion</th> <th></th> <th></th> <th></th> </tr> </thead> <tbody> <tr> <td><code>:prove</code></td> <td><code>\x</code></td> <td><code>-&gt;</code></td> <td><code>g (f x) == x</code></td> </tr> <tr> <td>"Prove to me"</td> <td>"that for all <code>x</code>"</td> <td>"it is true that"</td> <td>"<code>g</code> inverts <code>f</code>"</td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> </tr> </tbody> </table> <p><strong>EXERCISE</strong>: 2.2.1 The other direction</p> <p>Our example proof showed that <code>g</code> inverts <code>f</code> for all inputs. Does this work the other way around? Try it! If the proof fails, it will provide a <em>counterexample</em>. Use the counterexample to understand what went wrong.</p> <p><strong>EXERCISE</strong>: 2.2.2 DES inversion</p> <p>Use Cryptol to prove that <code>DES.encrypt</code> and <code>DES.decrypt</code> are inverses for all possible inputs. Show both directions.</p> <p><em>Hint</em>: Lambda functions can take more than one input, just like normal functions! For example: <code>\x y z -&gt; x+y+z</code></p> <p><em>Hint</em>: For fastest results, use the <code>abc</code> prover.</p> <h3> <a aria-hidden="true" class="anchor" href="#23-proof-of-injectivity" id="user-content-23-proof-of-injectivity"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.3 Proof of Injectivity</h3> <p>A function for which every input generates a distinct output is referred to in mathematics as <em>injective</em> or <em>one-to-one</em>. Cryptol can be used to prove that a function is injective.</p> <p><strong>EXERCISE</strong>: 2.3.1 DES Injectivity</p> <p>Show that, for any given key, <code>DES.encrypt</code> is injective (collision-free) with respect to plaintext.</p> <p>Technically, <code>DES.encrypt</code> (for any given key) is also <em>surjective</em> (<em>onto</em>) due to the fact that its domain and range are the same (The set of all possible 64-bit vectors.) A function that is both injective and surjective is called <em>bijective</em>.</p> <p><em>Hint</em>: Use the Boolector prover. (Even then, this proof may take a few minutes!)</p> <p><em>Hint</em>: Consider using the implication operator <code>==&gt;</code></p> <h3> <a aria-hidden="true" class="anchor" href="#24-collision-detection" id="user-content-24-collision-detection"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.4 Collision Detection</h3> <p>In cryptography, a <em>collision</em> occurs when two different inputs produce the same output. (That is, the function is <em>not</em> injective.) For some cryptographic functions, such as pseudo-random number generators (PRNGs), it may be desirable to demonstrate an absence of collisions. In other functions, such as cryptographic hash functions, collisions are inevitable, but should be difficult to discover. It is easy in Cryptol to ask the solver to search for collisions. (Though finding a solution may not be possible.)</p> <p><strong>EXERCISE</strong>: 2.4.1 DES Key Collisions</p> <p>Use the solver to find two different keys and a single plaintext such that both keys encrypt that plaintext to the same ciphertext.</p> <h3> <a aria-hidden="true" class="anchor" href="#25-equivalence-checking" id="user-content-25-equivalence-checking"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.5 Equivalence Checking</h3> <p>It's inevitable that there are collisions over the set of all key/plaintext pairs in DES, but it may be surprising that they're easy to find with Cryptol's solver. We now know that the two keys you just found encrypt one particular plaintext to the same ciphertext; more concerning would be if they perform the same transformation on <em>all</em> plaintexts. Such keys are called <em>equivalent</em> keys.</p> <p>One of the most powerful uses of Cryptol's theorem proving technology is the ability to show equivalence of two different functions for all possible inputs.</p> <p><strong>EXERCISE</strong>: 2.5.1 DES Equivalent Keys</p> <p>Prove that the two keys you just found are equivalent keys. That is, prove that these two keyed DES functions are equivalent for <em>all</em> plaintext inputs.</p> <p><em>Hint</em>: Use the <code>abc</code> prover.</p> <p><strong>EXERCISE</strong>: 2.5.2 DES Parity Bits</p> <p>Having equivalent keys is often considered a weakness in an a cipher. However, in the case of DES, it turns out that this is a result of a design choice. The lowest bit of each byte of a DES key is actually a <a href="https://en.wikipedia.org/wiki/Parity_bit" rel="nofollow">parity bit</a> that is completely ignored by the cipher itself. For DES, the parity bit ensures that the total number of 1-bits in each byte is odd.</p> <p>Write a function <code>DESFixParity : [64] -&gt; [64]</code> that takes any 64-bit vector and returns the equivalent DES key with properly computed parity bits. (This is the first and only time in this lab that you'll need to edit this file directly.)</p> <pre lang="cryptol"><code>DESFixParity : [64] -&gt; [64] DESFixParity key = undefined // Replace "undefined" with your code </code></pre> <p><strong>EXERCISE</strong>: 2.5.3 Proving DES Key Equivalence</p> <p>Use the function <code>DESFixParity</code> that you wrote above to show that DES completely ignores parity bits. That is, prove that the DES encryption that allows all 64-bit keys is equivalent to the DES encryption function that first corrects the parity bits on those keys.</p> <p>Given that this proof passes, what is the actual maximum key strength of DES in terms of bits?</p> <h1> <a aria-hidden="true" class="anchor" href="#solicitation" id="user-content-solicitation"><span aria-hidden="true" class="octicon octicon-link"></span></a>Solicitation</h1> <p>How was your experience with this labs Suggestions are welcome in the form of a ticket on the course GitHub page: <a href="https://github.com/weaversa/cryptol-course/issues">https://github.com/weaversa/cryptol-course/issues</a></p> <h1> <a aria-hidden="true" class="anchor" href="#from-here-you-can-go-somewhere" id="user-content-from-here-you-can-go-somewhere"><span aria-hidden="true" class="octicon octicon-link"></span></a>From here, you can go somewhere!</h1> <table> <thead> <tr> <th align="right"></th> <th align="center"></th> <th></th> </tr> </thead> <tbody> <tr> <td align="right"></td> <td align="center"><a href="/README.html">^ Course README</a></td> <td></td> </tr> <tr> <td align="right"><a href="/labs/Salsa20/Salsa20.html">&lt; Salsa20</a></td> <td align="center"><strong>Cryptographic Properties</strong></td> <td><a href="/labs/KeyWrapping/KeyWrapping.html">Key Wrapping &gt;</a></td> </tr> <tr> <td align="right"></td> <td align="center"><a href="/labs/CryptoProofs/CryptoProofsAnswers.html">! Cryptographic Properties (Answers)</a></td> <td></td> </tr> <tr> <td align="right"></td> <td align="center"></td> <td></td> </tr> <tr> <td align="right"></td> <td align="center"><a href="/labs/Salsa20/Salsa20Props.html">+ Salsa20 Properties</a></td> <td></td> </tr> <tr> <td align="right"></td> <td align="center"><a href="/labs/Transposition/Contents.html">+ Transposition Ciphers</a></td> <td></td> </tr> <tr> <td align="right"></td> <td align="center"><a href="/labs/ProjectEuler/ProjectEuler.html">+ Project Euler</a></td> <td></td> </tr> </tbody> </table> </article> </div> </div> </div> </div> </div> </div>
