<?xml version='1.0' encoding='UTF-8'?> <link href="/github-markdown-css/github-css.css" rel="stylesheet"/> <meta charset="utf-8" content="text/html"/> <div class="gist"> <style class="formula-style"> svg.gh-md-to-html-formula { fill: black; } </style> <div class="gist-file"> <!-- This is the class that is responsible for the boxing! --> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container file-box"> <div class="file" id="article-NQueens"> <div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px"> <article class="markdown-body entry-content container-lg" itemprop="text"> <h1> <a aria-hidden="true" class="anchor" href="#introduction" id="user-content-introduction"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h1> <p>This demo gives an overview of the N-Queens problem.</p> <h2> <a aria-hidden="true" class="anchor" href="#prerequisites" id="user-content-prerequisites"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h2> <p>Before working through this lab, you'll need</p> <ul> <li>Cryptol to be installed and</li> <li>this module to load successfully.</li> </ul> <p>You'll also need experience with</p> <ul> <li>loading modules and evaluating functions in the interpreter and</li> <li>the <code>:sat</code> command.</li> </ul> <h2> <a aria-hidden="true" class="anchor" href="#skills-youll-learn" id="user-content-skills-youll-learn"><span aria-hidden="true" class="octicon octicon-link"></span></a>Skills You'll Learn</h2> <p>By the end of this demo you'll understand a bit more about how Cryptol can use its interface to automated theorem provers to perform computation. Rather than write a search algorithm in Cryptol, one only needs to write a solution checker in Cryptol (much easier) and then let the automated theorem prover carry out the search.</p> <h2> <a aria-hidden="true" class="anchor" href="#load-this-module" id="user-content-load-this-module"><span aria-hidden="true" class="octicon octicon-link"></span></a>Load This Module</h2> <p>This lab is a <a href="https://en.wikipedia.org/wiki/Literate_programming" rel="nofollow">literate</a> Cryptol document --- that is, it can be loaded directly into the Cryptol interpreter. Load this module from within the Cryptol interpreter running in the <code>cryptol-course</code> directory with:</p> <pre lang="Xcryptol"><code>Loading module Cryptol Cryptol&gt; :m labs::Demos::Cryptol::NQueens Loading module Cryptol Loading module labs::Demos::Cryptol::NQueens </code></pre> <p>We start by defining a new module for this lab:</p> <pre lang="cryptol"><code>module labs::Demos::Cryptol::NQueens where </code></pre> <p>You do not need to enter the above into the interpreter; the previous <code>:m ...</code> command loaded this literate Cryptol file automatically.<br/> In general, you should run <code>Xcryptol session</code> commands in the interpreter and leave <code>cryptol</code> code alone to be parsed by <code>:m ...</code>.</p> <h1> <a aria-hidden="true" class="anchor" href="#n-queens" id="user-content-n-queens"><span aria-hidden="true" class="octicon octicon-link"></span></a>N-Queens</h1> <p>Cryptol is not just for crypto. Here, we demonstrate how Cryptol can solve the <a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle" rel="nofollow">N-Queens puzzle</a>. This demo draws from and cites <a href="https://github.com/GaloisInc/cryptol/blob/master/examples/funstuff/NQueens.cry">Galois, Inc.'s example</a> [1].</p> <p>Before proceeding, we define some helper functions. <code>product</code> returns the <a href="https://en.wikipedia.org/wiki/Cartesian_product" rel="nofollow">Cartesian product</a> of two sequences:</p> <pre lang="cryptol"><code>/** Cartesian product of sequences `X` and `Y` github-markdown-css/ html/ labs/ misc/ scripts/ specs/ product : {n, m, a, b} (fin m) =&gt; [n]a -&gt; [m]b -&gt; [n INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs m](a, b) product X Y = [ (i, j) | i &lt;- X, j &lt;- Y ] </code></pre> <p><code>distinct</code> checks whether each element in a sequence is unique. We will use this to determine whether queen positions (represented as a sequence of column positions within each row of the board) are unique. (If not, then at least two queens are in the same column, violating the N-Queens constraint.)</p> <pre lang="cryptol"><code>/** whether sequence `X` comprises unique items github-markdown-css/ html/ labs/ misc/ scripts/ specs/ distinct : {n, a} (fin n, Eq a) =&gt; [n]a -&gt; Bit distinct X = U == zero where M = map ((&gt;&gt;&gt;) `(min 1 n)) [`(min 1 n)...] U = foldl (||) zero [ (map ((==) x) X) ^ m | x &lt;- X | m &lt;- M ] </code></pre> <p>There are many interesting ways to write this function.</p> <p>This <code>distinct</code> function works roughly as follows:</p> <ul> <li>For each element: <ul> <li>Map matching elements (one bit per sequence item)</li> <li>Clear the self-matching bit (using rotating bitmask <code>M</code>)</li> </ul> </li> <li>Compute bitwise-or over remaining matches. (Remaining matches reflect duplicates.)</li> <li>Return <code>True</code> iff no matches remain.</li> <li> <code>(min 1 n)</code> evaluates to <code>1</code> unless an empty sequence is provided; such a sequence trivially comprises <code>distinct</code> elements. Without this generalization and using <code>1</code> instead, Cryptol would have required the sequence to be nonempty (<code>n &gt;= 1</code>).</li> </ul> <p>(The counterpart in [1] works roughly as follows:</p> <ul> <li>Enumerate an index over the sequence.</li> <li>Check for equality only over positions in index order (emulate a triangular search).</li> <li>Return <code>True</code> if any duplicate was found.)</li> </ul> <p>(Neither approach short circuits when a duplicate is found, so both end up with comparable performance for <code>nQueens</code>.)</p> <p>Next, we declare some type aliases to represent a chess <code>Board</code> and the <code>Position</code>s of queens on the board. A (proposed) <code>Solution</code> is a <code>Board</code> that meets (or violates) the N-Queens constraint.</p> <pre lang="cryptol"><code>/** row or column position in [0, `n`) github-markdown-css/ html/ labs/ misc/ scripts/ specs/ type Position n = [width (n-1)] /Applications /Library /System /Users /Volumes /bin /cores /dev /etc /home /opt /private /sbin /tmp /usr /var `n` x `n` square chess board github-markdown-css/ html/ labs/ misc/ scripts/ specs/ type Board n = [n](Position n) /Applications /Library /System /Users /Volumes /bin /cores /dev /etc /home /opt /private /sbin /tmp /usr /var `n`-queens solution github-markdown-css/ html/ labs/ misc/ scripts/ specs/ type Solution n = Board n -&gt; Bit </code></pre> <p>(Note: <code>Position</code> could be defined using modular integers <code>Z</code>, but its dual use for sequence indexing severely hinders performance for <code>nQueens</code>.)</p> <p>Next, we define a function to check whether two queens on the board can "see" each other diagonally:</p> <pre lang="cryptol"><code>/** INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs whether queens in rows `i` and `j` of `Q` can see each other INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs diagonally github-markdown-css/ html/ labs/ misc/ scripts/ specs/ checkDiag : {n} (fin n, n &gt;= 1) =&gt; Board n -&gt; (Position n, Position n) -&gt; Bit checkDiag Q (i, j) = (i &lt; j) ==&gt; (diffR != diffC) where qi = Q @ i qj = Q @ j diffR = if qi &gt;= qj then qi - qj else qj - qi diffC = j - i // we know i &lt; j </code></pre> <p>(This mostly follows [1], but swaps out eager <code>||</code> for lazy <code>==&gt;</code>; this doesn't matter much.)</p> <p>Next, we follow suit from [1] and define a function to return all possible row/column positions on a board (the Cartesian product of board positions):</p> <pre lang="cryptol"><code>/** board positions (Cartesian product of row `Position`s) github-markdown-css/ html/ labs/ misc/ scripts/ specs/ ijs : {n} (fin n, n &gt;= 1) =&gt; [_](Position n, Position n) ijs = product P P where P = [0 .. (n-1) : Position n] </code></pre> <p>As in [1], we define a function returning whether a <code>Position</code> within a row is actually on the board:</p> <pre lang="cryptol"><code>/** whether `x` is in a valid row `Position` of `Board` `Q` github-markdown-css/ html/ labs/ misc/ scripts/ specs/ inRange : {n} (fin n, n &gt;= 1) =&gt; Board n -&gt; Position n -&gt; Bit inRange Q x = x &lt;= `(n - 1) </code></pre> <p>We can now define the N-Queens constraint: a <code>Board</code> is a <code>Solution</code> to N-Queens iff all queens are on the board and cannot see each other:</p> <pre lang="cryptol"><code>/** whether `Board` `Q` satisfies the N-Queens constraint github-markdown-css/ html/ labs/ misc/ scripts/ specs/ nQueens : {n} (fin n, n &gt;= 1, width (n-1) &gt; 1) =&gt; Solution n nQueens Q = all (inRange Q) Q /\ // all queens are on board distinct Q /\ // no queens are in same column all (checkDiag Q) ijs`{n} // no queens are on same diagonal </code></pre> <p>The instructions for [1] also work here:</p> <blockquote> <p>To see this in action, try:</p> <pre lang="Xcryptol"><code>&gt; :sat nQueens : (Solution n) </code></pre> <p>where n is the board size.</p> <p>You may find that <code>cvc4</code> takes a long time for solutions bigger than 5. For those sizes, we have had good luck with both <code>yices</code> and <code>Z3</code>.</p> <p>To do that,</p> </blockquote> <p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p> <blockquote> <pre lang="Text"><code></code></pre> </blockquote> <p>=======</p> <blockquote> <pre lang="example"><code>&gt;&gt;&gt;&gt;&gt;&gt; origin/master &gt; :set prover=z3 </code></pre> <p>or</p> </blockquote> <p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p> <blockquote> <pre lang="Text"><code></code></pre> </blockquote> <p>=======</p> <blockquote> <pre lang="example"><code>&gt;&gt;&gt;&gt;&gt;&gt; origin/master &gt; :set prover=yices </code></pre> </blockquote> <p>Here is one possible outcome for <code>n = 8</code>:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::NQueens&gt; :s base=10 labs::Demos::Cryptol::NQueens&gt; :sat nQueens : (Solution 8) Satisfiable (nQueens : Solution 8) [1, 7, 5, 0, 2, 4, 6, 3] = True (Total Elapsed Time: 0.053s, using "Z3") </code></pre> <p>This corresponds to the following arrangement (diagram produced by <a href="https://chessboardjs.com/" rel="nofollow">chessboard.js</a>) (<a href="https://en.wikipedia.org/wiki/Eight_queens_puzzle#Solutions" rel="nofollow">Solution 8</a> in the Wikipedia article):</p> <p><a href="/html/images/NQueensSolution.png" rel="noopener noreferrer" target="_blank"><img alt="Solution to 8-Queens Puzzle" data-canonical-src="/html/images/NQueensSolution.png" src="/html/images/NQueensSolution.png" style="max-width:100%; max-height: 396px;"/></a></p> <h1> <a aria-hidden="true" class="anchor" href="#solicitation" id="user-content-solicitation"><span aria-hidden="true" class="octicon octicon-link"></span></a>Solicitation</h1> <p>How was your experience with this labs Suggestions are welcome in the form of a ticket on the course GitHub page: <a href="https://github.com/weaversa/cryptol-course/issues">https://github.com/weaversa/cryptol-course/issues</a></p> <h1> <a aria-hidden="true" class="anchor" href="#from-here-you-can-go-somewhere" id="user-content-from-here-you-can-go-somewhere"><span aria-hidden="true" class="octicon octicon-link"></span></a>From here, you can go somewhere!</h1> <table> <thead> <tr> <th align="right"></th> <th align="center"></th> <th></th> </tr> </thead> <tbody> <tr> <td align="right"></td> <td align="center"><a href="/labs/Demos/Cryptol/Demos.html">^ Cryptol Demos</a></td> <td></td> </tr> <tr> <td align="right"><a href="/labs/Demos/Cryptol/OneTimePad.html">&lt; One-Time Pad</a></td> <td align="center"><strong>n-Queens</strong></td> <td><a href="/labs/Demos/Cryptol/Sudoku.html">Sudoku &gt;</a></td> </tr> </tbody> </table> </article> </div> </div> </div> </div> </div> </div>
