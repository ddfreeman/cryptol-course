<?xml version='1.0' encoding='UTF-8'?> <link href="/github-markdown-css/github-css.css" rel="stylesheet"/> <meta charset="utf-8" content="text/html"/> <div class="gist"> <style class="formula-style"> svg.gh-md-to-html-formula { fill: black; } </style> <div class="gist-file"> <!-- This is the class that is responsible for the boxing! --> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container file-box"> <div class="file" id="article-OneTimePad"> <div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px"> <article class="markdown-body entry-content container-lg" itemprop="text"> <h1> <a aria-hidden="true" class="anchor" href="#introduction" id="user-content-introduction"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h1> <p>This demo gives an overview of a simple cryptographic operation, the one-time pad.</p> <h2> <a aria-hidden="true" class="anchor" href="#prerequisites" id="user-content-prerequisites"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h2> <p>Before working through this lab, you'll need</p> <ul> <li>Cryptol to be installed and</li> <li>this module to load successfully.</li> </ul> <p>You'll also need experience with</p> <ul> <li>loading modules and evaluating functions in the interpreter and</li> <li>the <code>:prove</code> and <code>:sat</code> commands.</li> </ul> <h2> <a aria-hidden="true" class="anchor" href="#skills-youll-learn" id="user-content-skills-youll-learn"><span aria-hidden="true" class="octicon octicon-link"></span></a>Skills You'll Learn</h2> <p>By the end of this demo you'll understand a bit more about the Cryptol language and how to use the interpreter to prove properties or find bugs in Cryptol specifications.</p> <h2> <a aria-hidden="true" class="anchor" href="#load-this-module" id="user-content-load-this-module"><span aria-hidden="true" class="octicon octicon-link"></span></a>Load This Module</h2> <p>This lab is a <a href="https://en.wikipedia.org/wiki/Literate_programming" rel="nofollow">literate</a> Cryptol document --- that is, it can be loaded directly into the Cryptol interpreter. Load this module from within the Cryptol interpreter running in the <code>cryptol-course</code> directory with:</p> <pre lang="Xcryptol"><code>Loading module Cryptol Cryptol&gt; :m labs::Demos::Cryptol::OneTimePad Loading module Cryptol Loading module Cryptol Loading module labs::Demos::Cryptol::OneTimePad </code></pre> <p>We start by defining a new module for this lab:</p> <pre lang="cryptol"><code>module labs::Demos::Cryptol::OneTimePad where </code></pre> <p>You do not need to enter the above into the interpreter; the previous <code>:m ...</code> command loaded this literate Cryptol file automatically.<br/> In general, you should run <code>Xcryptol session</code> commands in the interpreter and leave <code>cryptol</code> code alone to be parsed by <code>:m ...</code>.</p> <h1> <a aria-hidden="true" class="anchor" href="#one-time-pad" id="user-content-one-time-pad"><span aria-hidden="true" class="octicon octicon-link"></span></a>One-Time Pad</h1> <p>Cryptol's documentation includes the excellent <a href="https://cryptol.net/files/ProgrammingCryptol.pdf" rel="nofollow">Programming Cryptol</a>, a comprehensive introduction to Cryptol that offers a "crash course" in the fundamentals before moving on to:</p> <ul> <li>a chapter on classic ciphers such as: <ul> <li> <a href="https://en.wikipedia.org/wiki/Caesar_cipher" rel="nofollow">Caesar</a>,</li> <li> <a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher" rel="nofollow">Vigen√®re</a>, and</li> <li> <a href="https://en.wikipedia.org/wiki/Atbash" rel="nofollow">Atbash</a>,</li> </ul> </li> </ul> <ul> <li>a chapter on the <a href="https://en.wikipedia.org/wiki/Enigma_machine" rel="nofollow">Enigma machine</a>,</li> <li>a chapter on proving simple properties about algorithms (by invoking Boolean satisfiability modulo theories, or "SMT", solvers), and</li> <li>a chapter on the more modern <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" rel="nofollow">Advanced Encryption Standard</a> (AES).</li> </ul> <p>That sounds too complicated for now. Let's start with a motivating example based on the <a href="https://en.wikipedia.org/wiki/One-time_pad" rel="nofollow">One-Time Pad</a>, a simple theoretically perfect but impractical technique in which plaintext is paired with a <a href="https://en.wikipedia.org/wiki/Pre-shared_key" rel="nofollow">pre-shared key</a> that is at least as long as the plaintext and only used once.</p> <h2> <a aria-hidden="true" class="anchor" href="#example" id="user-content-example"><span aria-hidden="true" class="octicon octicon-link"></span></a>Example</h2> <p>Suppose Alice wishes to encipher the message <code>HELLO</code> using the pre-shared key <code>ZUGESAGT</code> with <a href="https://ascii.cl" rel="nofollow">ASCII</a> encoding and the <a href="https://en.wikipedia.org/wiki/Exclusive_or" rel="nofollow">XOR</a> pairing operation. Then she encodes <code>HELLO</code> as the ASCII hexadecimal sequence <code>[0x48, 0x45, 0x4C, 0x4C, 0x4F]</code> and <code>ZUGES</code> (the letters needed from the one-time pad to cover the plaintext) as <code>[0x5A, 0x55, 0x47, 0x45, 0x53]</code>. Pairing these yields the ciphertext <code>[0x48^0x5A, 0x45^0x55, 0x4C^0x47, 0x4C^0x45, 0x4F^0x53] == [0x12, 0x10, 0x0B, 0x09, 0x1C]</code>, which she sends to Bob. Bob, also knowing the pre- shared key <code>ZUGESAGT</code>, observes that the ciphertext <code>[0x12, 0x10, 0x0B, 0x09, 0x1C]</code> has length <code>5</code>, likewise encodes enough of the pre-shared key (<code>ZUGES</code>) as <code>[0x5A, 0x55, 0x47, 0x45, 0x53]</code>, applies the reverse pairing operation (which is also <code>XOR</code>), yielding the original plaintext <code>[0x12^0x5A, 0x10^0x55, 0x0B^0x47, 0x09^0x45, 0x1C^0x53] == [0x48, 0x45, 0x4C, 0x4C, 0x4F]</code> (<code>"HELLO"</code>). Both parties must then unfortunately discard <code>ZUGES</code> so attackers can't exploit it -- one-time pad and all that.</p> <h2> <a aria-hidden="true" class="anchor" href="#hello-cryptol" id="user-content-hello-cryptol"><span aria-hidden="true" class="octicon octicon-link"></span></a>Hello Cryptol</h2> <p>That was a pretty vague and long-winded bloviation about the humble one-time pad. We could use Cryptol to express this algorithm clearly and concisely (provided the audience can read the language).</p> <pre lang="cryptol"><code>/** Encrypt plaintext `pt` using pre-shared key `psk` github-markdown-css/ html/ labs/ misc/ scripts/ specs/ encrypt : {k, m} (fin k, k &gt;= m) =&gt; (String k) -&gt; (String m) -&gt; (String m) encrypt psk pt = ct where ct = (take psk) ^ pt /Applications /Library /System /Users /Volumes /bin /cores /dev /etc /home /opt /private /sbin /tmp /usr /var Decrypt plaintext; same as `encrypt` github-markdown-css/ html/ labs/ misc/ scripts/ specs/ decrypt = encrypt /Applications /Library /System /Users /Volumes /bin /cores /dev /etc /home /opt /private /sbin /tmp /usr /var INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs Check test vector INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs "ZUGESAGT" "HELLO" -&gt; [0x12, 0x10, 0x0B, 0x09, 0x1C] github-markdown-css/ html/ labs/ misc/ scripts/ specs/ property test = (encrypt "ZUGESAGT" "HELLO" == [0x12, 0x10, 0x0B, 0x09, 0x1C]) /Applications /Library /System /Users /Volumes /bin /cores /dev /etc /home /opt /private /sbin /tmp /usr /var INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs Verify that for any pre-shared key `psk` and plaintext `pt` of INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs size 8 and 5, respectively, decrypting ciphertext encrypted INSTALL.md LICENSE README.md cryptol-style.md github-markdown-css html index.html labs misc scripts specs using the same pre-shared key yields the original plaintext github-markdown-css/ html/ labs/ misc/ scripts/ specs/ property decrypt_of_encrypt_yields_original_plaintext_8_5 (psk, pt) = (decrypt psk (encrypt`{8, 5} psk pt)) == pt </code></pre> <h2> <a aria-hidden="true" class="anchor" href="#setting-and-reading-variables" id="user-content-setting-and-reading-variables"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setting and Reading Variables</h2> <p>Great. Now let's try applying the module to the previous example:</p> <pre lang="cryptol"><code>psk1 = "ZUGESAGT" pt1 = "HELLO" ct1 = (encrypt psk1 pt1) </code></pre> <p>OK, we've assigned variables representing the pre-shared key (<code>psk1</code>), plaintext (<code>pt1</code>), and ciphertext (<code>ct1</code>) from the example. Let's see the plaintext:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; pt1 [0x48, 0x45, 0x4c, 0x4c, 0x4f] </code></pre> <p>That wasn't what we assigned to <code>pt1</code>!!! Actually it is, just shown differently, in this case as a sequence of 5 hexadecimal bytes rather than a string of 5 characters. We can ask the interpreter to show us a string instead:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :s ascii=on labs::Demos::Cryptol::OneTimePad&gt; pt1 "HELLO" </code></pre> <p>That was pleasant. Now let's see the ciphertext:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; ct1 "\DC2\DLE\v\t\FS" </code></pre> <p>That looks ciphertexty, all right. Entering <code>:s</code> shows all the configuration settings:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :s ascii = on base = 16 core-lint = off debug = off infLength = 5 mono-binds = on prover = z3 prover-stats = on satNum = 1 smtfile = - tc-debug = 0 tc-solver = z3 -smt2 -in tests = 100 warnDefaulting = on warnShadowing = on </code></pre> <h2> <a aria-hidden="true" class="anchor" href="#help" id="user-content-help"><span aria-hidden="true" class="octicon octicon-link"></span></a>Help!!!</h2> <p>If a symbol's name isn't descriptive enough, we can use <code>:h</code> to display help text for it:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :h encrypt encrypt : {k, m} (fin k, k &gt;= m) =&gt; String k -&gt; String m -&gt; String m `(encrypt psk pt)` encrypts plaintext `pt` using pre-shared key `psk`. </code></pre> <h2> <a aria-hidden="true" class="anchor" href="#function-evaluation" id="user-content-function-evaluation"><span aria-hidden="true" class="octicon octicon-link"></span></a>Function Evaluation</h2> <p>Cool. Let's do a quick sanity check:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; decrypt psk1 ct1 "HELLO" </code></pre> <h2> <a aria-hidden="true" class="anchor" href="#previous-result" id="user-content-previous-result"><span aria-hidden="true" class="octicon octicon-link"></span></a>Previous Result</h2> <p>It matches! Our sanity is intact. Well, maybe not -- let's make sure:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; it == pt1 True </code></pre> <h2> <a aria-hidden="true" class="anchor" href="#test-vectors" id="user-content-test-vectors"><span aria-hidden="true" class="octicon octicon-link"></span></a>Test Vectors</h2> <p>Nice! So that one example checks out, as expressed by the <code>test</code> property in our module. Let's prove it:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :prove test Q.E.D. (Total Elapsed Time: 0.028s, using Z3) </code></pre> <p>(For concrete test vectors like this one, <code>:check test</code> also fits the bill and is marginally faster...but it's important to remember to do this only for static test vectors and properties that <code>:prove</code> can't finish in the time you are willing to wait.)</p> <h2> <a aria-hidden="true" class="anchor" href="#properties" id="user-content-properties"><span aria-hidden="true" class="octicon octicon-link"></span></a>Properties</h2> <p>That's just one test vector, but Cryptol is not just a test runner. We can apply SMT solving to prove it for all cases (of a particular type), as reflected in the <code>decrypt_of_encrypt_yields_original_plaintext_8_5</code> property. That's a rather sesquipedalian name; let's use tab-completion to prove the property:</p> <pre lang="Text"><code>labs::Demos::Cryptol::OneTimePad&gt; :prove dec&lt;Tab&gt; labs::Demos::Cryptol::OneTimePad&gt; :prove decrypt_&lt;Tab&gt; labs::Demos::Cryptol::OneTimePad&gt; :prove decrypt_of_encrypt_yields_original_plaintext_8_5&lt;Enter&gt; Q.E.D. (Total Elapsed Time: 0.028s, using Z3) </code></pre> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :prove decrypt_of_encrypt_yields_original_plaintext_8_5 Q.E.D. </code></pre> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :prove decrypt_of_encrypt_yields_original_plaintext_8_5 Q.E.D. </code></pre> <h2> <a aria-hidden="true" class="anchor" href="#satisfiability" id="user-content-satisfiability"><span aria-hidden="true" class="octicon octicon-link"></span></a>Satisfiability</h2> <p>Good to know. Another use of SMT solving is to find an input satisfying a property. We could apply this to our one-time pad by demonstrating why using the one-time pad (pre-shared key) more than one time is not a good idea. Suppose Bob replies to Alice with a second plaintext/ciphertext exchange also using the pre-shared key <code>ZUGESAGT</code>:</p> <pre lang="cryptol"><code>pt2 = "GOODBYE" ct2 = (encrypt psk1 pt2) </code></pre> <p>Now suppose an attacker Eve doesn't know the pre-shared key, but has compromised Bob's network port, sees a 7-character message, and deduces that with no further communication the message might reasonably have been "GOODBYE". Then Eve can exploit Cryptol to deduce the pre-shared key Bob just used:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; :sat \psk2 -&gt; (encrypt`{7} psk2 pt2) == ct2 Satisfiable (\psk2 -&gt; (encrypt`{7} psk2 pt2) == ct2) "ZUGESAG" = True (Total Elapsed Time: 0.044s, using "Z3") </code></pre> <p>(That "<code>-&gt;</code>" syntax defines a <a href="https://en.wikipedia.org/wiki/Anonymous_function" rel="nofollow">lambda function</a> that maps one argument (<code>psk2</code>) to an expression that will return <code>True</code> or <code>False</code>, basically asking for a pre-shared key that encrypts the given plaintext to the given ciphertext. Of course, Eve could have just applied <code>XOR</code> directly; this example is silly.)</p> <p>Now that Eve has the pre-shared key for this exchange, she could stash <code>it</code> and try <code>it</code> (<code>it</code> is the counterexample produced by the last <code>:sat</code> command) on the message Bob received earlier:</p> <pre lang="Xcryptol"><code>labs::Demos::Cryptol::OneTimePad&gt; it {result = True, arg1 = "ZUGESAG"} labs::Demos::Cryptol::OneTimePad&gt; :sat \pt3 -&gt; (encrypt (it.arg1) pt3) == ct1 Satisfiable (\pt3 -&gt; (encrypt "ZUGESAG" pt3) == ct) "HELLO" = True (Total Elapsed Time: 0.028s, using Z3) </code></pre> <p>Hello!!! So much for communications security...</p> <h1> <a aria-hidden="true" class="anchor" href="#conclusion" id="user-content-conclusion"><span aria-hidden="true" class="octicon octicon-link"></span></a>Conclusion</h1> <p>Well that was fun. We have clearly expressed the one-time pad using Cryptol, demonstrated it on some test cases, verified some simple properties, and manipulated it for nefarious misdeeds.</p> <h1> <a aria-hidden="true" class="anchor" href="#solicitation" id="user-content-solicitation"><span aria-hidden="true" class="octicon octicon-link"></span></a>Solicitation</h1> <p>How was your experience with this labs Suggestions are welcome in the form of a ticket on the course GitHub page: <a href="https://github.com/weaversa/cryptol-course/issues">https://github.com/weaversa/cryptol-course/issues</a></p> <h1> <a aria-hidden="true" class="anchor" href="#from-here-you-can-go-somewhere" id="user-content-from-here-you-can-go-somewhere"><span aria-hidden="true" class="octicon octicon-link"></span></a>From here, you can go somewhere!</h1> <table> <thead> <tr> <th align="right"></th> <th align="center"></th> <th></th> </tr> </thead> <tbody> <tr> <td align="right"></td> <td align="center"><a href="/labs/Demos/Cryptol/Demos.html">^ Cryptol Demos</a></td> <td></td> </tr> <tr> <td align="right"><a href="/labs/Demos/Cryptol/Caesar.html">&lt; Caesar</a></td> <td align="center"><strong>One-Time Pad</strong></td> <td><a href="/labs/Demos/Cryptol/NQueens.html">n-Queens &gt;</a></td> </tr> </tbody> </table> </article> </div> </div> </div> </div> </div> </div>
