<?xml version='1.0' encoding='UTF-8'?> <link href="/github-markdown-css/github-css.css" rel="stylesheet"/> <meta charset="utf-8" content="text/html"/> <div class="gist"> <style class="formula-style"> svg.gh-md-to-html-formula { fill: black; } </style> <div class="gist-file"> <!-- This is the class that is responsible for the boxing! --> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container file-box"> <div class="file" id="article-Salsa20PropsAnswers"> <div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px"> <article class="markdown-body entry-content container-lg" itemprop="text"> <h1> <a aria-hidden="true" class="anchor" href="#introduction" id="user-content-introduction"><span aria-hidden="true" class="octicon octicon-link"></span></a>Introduction</h1> <p>This lab provides a series of exercises focused on security proofs about a cryptographic algorithm called Salsa20, by Daniel J. Bernstein.</p> <h2> <a aria-hidden="true" class="anchor" href="#prerequisites" id="user-content-prerequisites"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prerequisites</h2> <p>Before working through this lab, you'll need</p> <ul> <li>Cryptol to be installed,</li> <li>this module to load successfully, and</li> <li>an editor for completing the exercises in this file.</li> </ul> <p>You'll also need experience with</p> <ul> <li>loading modules and evaluating functions in the interpreter,</li> <li>Cryptol's sequence types,</li> <li>the <code>:prove</code> command,</li> <li>manipulating sequences using <code>map</code>, <code>iterate</code>,</li> <li>writing functions and properties, and</li> <li>logical, comparison, arithmetic, and indexing operators.</li> </ul> <h2> <a aria-hidden="true" class="anchor" href="#skills-youll-learn" id="user-content-skills-youll-learn"><span aria-hidden="true" class="octicon octicon-link"></span></a>Skills You'll Learn</h2> <p>By the end of this lab you will have proven some security properties about Salsa20.</p> <p>You'll also gain experience with</p> <ul> <li>type parameters and type constraints,</li> <li>manipulating sequences, and</li> <li>writing functions and properties.</li> </ul> <h2> <a aria-hidden="true" class="anchor" href="#load-this-module" id="user-content-load-this-module"><span aria-hidden="true" class="octicon octicon-link"></span></a>Load This Module</h2> <p>This lab is a <a href="https://en.wikipedia.org/wiki/Literate_programming" rel="nofollow">literate</a> Cryptol document --- that is, it can be loaded directly into the Cryptol interpreter. Load this module from within the Cryptol interpreter running in the <code>cryptol-course</code> directory with:</p> <pre lang="Xcryptol"><code>Loading module Cryptol Cryptol&gt; :m labs::Salsa20::Salsa20PropsAnswers Loading module Cryptol Loading module labs::Salsa20::Salsa20Answers Loading module labs::Salsa20::Salsa20PropsAnswers </code></pre> <p>We start by defining a new module for this lab and importing the Salsa20 specification from a prior lab:</p> <pre lang="cryptol"><code>module labs::Salsa20::Salsa20PropsAnswers where import labs::Salsa20::Salsa20Answers </code></pre> <p>You do not need to enter the above into the interpreter; the previous <code>:m ...</code> command loaded this literate Cryptol file automatically. In general, you should run <code>Xcryptol session</code> commands in the interpreter and leave <code>cryptol</code> code alone to be parsed by <code>:m ...</code>.</p> <h1> <a aria-hidden="true" class="anchor" href="#salsa20-security-properties" id="user-content-salsa20-security-properties"><span aria-hidden="true" class="octicon octicon-link"></span></a>Salsa20 Security Properties</h1> <p>In this lab, we consider additional properties of the <a href="Salsa20Spec.html">Salsa20 stream cipher</a> [5], which has undergone much scrutiny since being proposed for <a href="https://www.ecrypt.eu.org/stream" rel="nofollow">eSTREAM, the ECRYPT Stream Cipher Project</a>.</p> <h2> <a aria-hidden="true" class="anchor" href="#invertibility" id="user-content-invertibility"><span aria-hidden="true" class="octicon octicon-link"></span></a>Invertibility</h2> <p>Throughout <a href="Salsa20Spec.pdf">the Salsa20 spec</a> [5], various functions are noted as being "invertible". In the <a href="Salsa20Answers.html">Salsa20 lab</a>, we proved that the <code>quarterround</code> and <code>littleendian</code> functions are invertible. We did this because the specification explicitly mentioned these properties. Similarly, though not called out in the specification, other functions defined in the spec are also invertible.</p> <p><strong>EXERCISE</strong>: Below is a rundown of each function defined in the spec. Your goal is to prove that each are invertible by filling in a property for each that attempts to prove invertibility.</p> <h3> <a aria-hidden="true" class="anchor" href="#rowround" id="user-content-rowround"><span aria-hidden="true" class="octicon octicon-link"></span></a>rowround</h3> <pre lang="cryptol"><code>property rowroundIsInvertibleProp y y' = y != y' ==&gt; rowround y != rowround y' </code></pre> <h3> <a aria-hidden="true" class="anchor" href="#columnround" id="user-content-columnround"><span aria-hidden="true" class="octicon octicon-link"></span></a>columnround</h3> <pre lang="cryptol"><code>property columnroundIsInvertibleProp x x' = x != x' ==&gt; columnround x != columnround x' </code></pre> <h3> <a aria-hidden="true" class="anchor" href="#doubleround" id="user-content-doubleround"><span aria-hidden="true" class="octicon octicon-link"></span></a>doubleround</h3> <p>This next one (<code>doubleround</code>) may take about a minute to prove using the <code>z3</code> solver. It may also seem a bit frustrating to have to wait, but please keep in mind that the solver is searching over a space of about <code>2^^1024</code> possibilities.</p> <pre lang="cryptol"><code>property doubleroundIsInvertibleProp xs xs' = xs != xs' ==&gt; doubleround xs != doubleround xs' </code></pre> <h3> <a aria-hidden="true" class="anchor" href="#salsa20core" id="user-content-salsa20core"><span aria-hidden="true" class="octicon octicon-link"></span></a>Salsa20Core</h3> <p>So far we've been proving that functions are invertible by showing that no two different inputs cause a function's outputs to <em>collide</em>. Though, for <code>Salsa20Core</code> we'll actually be trying to find such collisions.</p> <p><a href="http://cr.yp.to/salsa20.html" rel="nofollow">Dr. Bernstein states</a> [1],</p> <blockquote> <p>I originally introduced the Salsa20 core as the "Salsa20 hash function," but this terminology turns out to confuse people who think that "hash function" means "collision-resistant compression function." The Salsa20 core does not compress and is not collision-resistant.</p> </blockquote> <p>This was <a href="https://cr.yp.to/snuffle/reoncore-20080224.pdf" rel="nofollow">in response</a> [2] to a <a href="https://www.iacr.org/archive/fse2008/50860470/50860470.pdf" rel="nofollow">paper detailing collisions in Salsa20</a> [3], which Dr. Bernstein calls</p> <blockquote> <p>plagiarism of an observation that was made by Matt Robshaw in June 2005, that was <a href="https://groups.google.com/d/msg/sci.crypt/AkQnSoO40BA/o4eG96rjkgYJ" rel="nofollow">independently posted to <code>sci.crypt</code></a> [4] by David Wagner in September 2005...</p> </blockquote> <p>High drama!</p> <p>The notion that <code>Salsa20Core</code> does not compress is obvious from its type signature (<code>Bytes 64 -&gt; Bytes 64</code>). So, we'll work now to show that <code>Salsa20Core</code> collides.</p> <p>The security of many cryptographic algorithms relies on <a href="https://en.wikipedia.org/wiki/Collision_resistance" rel="nofollow">collision resistance</a>. Collisions are actually OK in many types of cryptography (think hash functions), but collisions should be <em>astronomically</em> hard to find. Here, Dr. Bernstein says that collisions exist in <code>Salsa20Core</code> and are easy to find, though not so easy that <code>z3</code> just works out of the box.</p> <p>We know from the section above that <code>doubleround</code> is collision free. Collision free functions remain so even when iterated (<code>Salsa20Core</code> iterates <code>doubleround</code> ten times). The proof of this last statement is left to the reader -- we suggest the <a href="https://en.wikipedia.org/wiki/100_prisoners_problem" rel="nofollow">100 prisoners problem</a> as a good starting place. Then, where do the collisions in <code>Salsa20Core</code> come from? Looking over the details of <code>Salsa20Core</code>, we see operations that reshape bytes to words and back, but reshaping also doesn't cause collisions. All that's left is <code>+</code>. The original specification states that</p> <blockquote> <p>Salsa20Core x = x + doubleround10 x</p> </blockquote> <p>To demonstrate the potential for a collision here, consider what would happen if <code>x</code> was a single bit and <code>doubleround10 0 == 1</code> and <code>doubleround10 1 == 0</code>. In this case, <code>doubleround10</code> is collision free, but <code>Salsa20Core</code> would return <code>1</code> when given <code>x = 0</code> and <code>x = 1</code> -- a collision. Next we move on to finding such collisions using the fully defined function.</p> <p>Working from <a href="https://www.iacr.org/archive/fse2008/50860470/50860470.pdf" rel="nofollow">[3]</a>, Theorem 6 states the collision property for <code>Salsa20Core</code>:</p> <blockquote> <p>Any pair of inputs M and M' (defined below) such that <code>Z &lt; 2^^31</code> and <code>Z' = Z + 2^^31</code>, generate a collision for any number of rounds of the <code>Salsa20</code> "hash" [core] function, producing <code>h</code> (defined below) as a common hash value.</p> <pre lang="comment"><code>M = [ Z , -Z , Z , -Z , -Z , Z , -Z , Z , Z , -Z , Z , -Z , -Z , Z , -Z , Z ] M' = [ Z', -Z', Z', -Z' , -Z', Z', -Z', Z' , Z', -Z', Z', -Z' , -Z', Z', -Z', Z' ] h = 2*M </code></pre> </blockquote> <p>In this definition, <code>Z</code> and <code>Z'</code> are <code>Word</code>s, but our Cryptol spec follows the original in defining <code>Salsa20Core</code> to map <code>Bytes 64 -&gt; Bytes 64</code>. Thus, we will reshape <code>Salsa20Core</code> before proceeding:</p> <p><strong>EXERCISE</strong>: Define <code>Salsa20Core'</code> to mimic <code>Salsa20Core</code>, but over <code>Words 16</code> rather than <code>Bytes 64</code>: (Hint: This can be defined in one line with <code>doubleround</code>, <code>iterate</code>, and basic Cryptol operators.)</p> <pre lang="cryptol"><code>/** `Salsa20Core` equivalent over `Words 16` github-markdown-css/ html/ labs/ misc/ scripts/ specs/ Salsa20Core' : Words 16 -&gt; Words 16 Salsa20Core' x = x + (iterate doubleround x @ 10) </code></pre> <p><strong>EXERCISE</strong>: Verify that <code>Salsa20Core'</code> agrees with <code>Salsa20Core</code>:</p> <pre lang="cryptol"><code>property Salsa20CoreEquivProp w = Salsa20Core' (rejigger w) == rejigger (Salsa20Core w) where rejigger x = map littleendian (split x) </code></pre> <p>Theorem 6 (from above) states that collisions should happen for any number of iterations of <code>Salsa20Core</code>. However, we're just going to ask that you prove it for one iteration. If you are highly motivated, feel free to attempt the more general proof (though don't expect any extra credit).</p> <p><strong>EXERCISE</strong>: Formalize Theorem 6:</p> <pre lang="cryptol"><code>Salsa20CoreCollidesProp : [32] -&gt; Bit property Salsa20CoreCollidesProp Z = h == h' where Z' = Z + (2^^31) M = [ Z , -Z , Z , -Z , -Z , Z , -Z , Z , Z , -Z , Z , -Z , -Z , Z , -Z , Z ] M' = [ Z', -Z', Z', -Z' , -Z', Z', -Z', Z' , Z', -Z', Z', -Z' , -Z', Z', -Z', Z'] h = Salsa20Core' M h' = Salsa20Core' M' </code></pre> <h3> <a aria-hidden="true" class="anchor" href="#salsa20encrypt" id="user-content-salsa20encrypt"><span aria-hidden="true" class="octicon octicon-link"></span></a><code>Salsa20Encrypt</code> </h3> <p>Finally, we want to show that <code>Salsa20Encrypt</code> is invertible (i.e. there exists a <code>Salsa20Decrypt</code> function that inverts <code>Salsa20Encrypt</code> for a given key and nonce). It turns out that <code>Salsa20Encrypt</code> is its own inverse, a so-called <a href="https://en.wikipedia.org/wiki/Involution_(mathematics)" rel="nofollow">involution</a>. That is, composing <code>Salsa20Encrypt</code> twice on a given key and nonce yields the original plaintext.</p> <p><strong>EXERCISE</strong>: Specify that <code>Salsa20_encrypt</code> is an involution and use the myriad of properties below to help verify your work.</p> <pre lang="cryptol"><code>Salsa20EncryptInvolutionProp : {a, l} (a &gt;= 1, 2 &gt;= a, l &lt;= 2^^70) =&gt; Bytes (16*a) -&gt; Bytes 8 -&gt; Bytes l -&gt; Bit Salsa20EncryptInvolutionProp k v m = Salsa20Encrypt k v (Salsa20Encrypt k v m) == m </code></pre> <pre lang="cryptol"><code>property Salsa20EncryptInvolutionProp_1_1 = Salsa20EncryptInvolutionProp`{1,1} property Salsa20EncryptInvolutionProp_1_8 = Salsa20EncryptInvolutionProp`{1,8} property Salsa20EncryptInvolutionProp_1_64 = Salsa20EncryptInvolutionProp`{1,64} property Salsa20EncryptInvolutionProp_1_128 = Salsa20EncryptInvolutionProp`{1,128} property Salsa20EncryptInvolutionProp_2_1 = Salsa20EncryptInvolutionProp`{2,1} property Salsa20EncryptInvolutionProp_2_8 = Salsa20EncryptInvolutionProp`{2,8} property Salsa20EncryptInvolutionProp_2_64 = Salsa20EncryptInvolutionProp`{2,64} property Salsa20EncryptInvolutionProp_2_128 = Salsa20EncryptInvolutionProp`{2,128} </code></pre> <h1> <a aria-hidden="true" class="anchor" href="#references" id="user-content-references"><span aria-hidden="true" class="octicon octicon-link"></span></a>References</h1> <p>[1] <a href="http://cr.yp.to/salsa20.html" rel="nofollow">The Salsa20 core</a> D. Bernstein</p> <p>[2] <a href="https://cr.yp.to/snuffle/reoncore-20080224.pdf" rel="nofollow">Response to "On the Salsa20 Core Function"</a> D. Bernstein</p> <p>[3] <a href="https://www.iacr.org/archive/fse2008/50860470/50860470.pdf" rel="nofollow">On the Salsa20 Core Function</a> J.C. Hernandez-Castro, et. al.</p> <p>[4] <a href="https://groups.google.com/d/msg/sci.crypt/AkQnSoO40BA/o4eG96rjkgYJ" rel="nofollow">Re-rolled Salsa20 function</a> P. Rubin, D. Wagner, et. al.</p> <p>[5] <a href="https://cr.yp.to/snuffle/spec.pdf" rel="nofollow">Salsa20 specification</a> D. Bernstein</p> <h1> <a aria-hidden="true" class="anchor" href="#solicitation" id="user-content-solicitation"><span aria-hidden="true" class="octicon octicon-link"></span></a>Solicitation</h1> <p>How was your experience with this labs Suggestions are welcome in the form of a ticket on the course GitHub page: <a href="https://github.com/weaversa/cryptol-course/issues">https://github.com/weaversa/cryptol-course/issues</a></p> <h1> <a aria-hidden="true" class="anchor" href="#from-here-you-can-go-somewhere" id="user-content-from-here-you-can-go-somewhere"><span aria-hidden="true" class="octicon octicon-link"></span></a>From here, you can go somewhere!</h1> <table> <thead> <tr> <th align="right"></th> <th align="center"></th> <th></th> </tr> </thead> <tbody> <tr> <td align="right"></td> <td align="center"><a href="/labs/CryptoProofs/CryptoProofs.html">- Cryptographic Properties</a></td> <td></td> </tr> <tr> <td align="right"></td> <td align="center"><strong>Salsa20 Properties (Answers)</strong></td> <td></td> </tr> <tr> <td align="right"></td> <td align="center"><a href="/labs/Salsa20/Salsa20Props.html">? Salsa20 Properties</a></td> <td></td> </tr> </tbody> </table> </article> </div> </div> </div> </div> </div> </div>
